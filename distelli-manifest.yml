bmcgehee/ipv6utility:
  Type: Python
  OS: Ubuntu
  Env:
    - PORT: 8000
    - ROOT_PASSWORD: "pa55w0rd"
    - DOC_PASSWORD: "pa55w0rd"

  #PkgInclude:
  #  - "/*/"
  #PkgExclude:
  #  - "*.py~"
  #  - "*.pyc"
  CommitData:
    - RepoType: Git
    - RepoPath: .
    
  PreInstall:
    - 'echo "Starting PreInstall for IPv6Utility"'
    - 'sudo debconf-set-selections <<< "mysql-server mysql-server/root_password password $ROOT_PASSWORD"'
    - 'sudo debconf-set-selections <<< "mysql-server mysql-server/root_password_again password $ROOT_PASSWORD"'
    - 'sudo apt-get -y install mysql-server'
    - 'sudo apt-get -y install libmysqlclient-dev'
    - 'sudo apt-get -y install python-dev'
    - 'sudo apt-get -y install python-pip'
    - mysql -u root -p$ROOT_PASSWORD -e 'create database ipv6_prefixes; GRANT ALL PRIVILEGES ON ipv6_prefixes.* TO doc@localhost IDENTIFIED BY "'"$DOC_PASSWORD"'"'
    - 'sudo pip install Django'
    - 'sudo pip install MySQL-python'

  Install:
    - 'echo "Starting Install for IPv6Utility"'
    
  PostInstall:
    - 'echo "Starting PostInstall for IPv6Utility"'
    - 'python manage.py migrate'
    - 'python manage.py makemigrations ipv6app'
    - 'python db_populate.py'

  Exec:
    - "exec python manage.py runserver 0.0.0.0:8000"

